# Render Deployment Guide

## Issues Fixed

1. ✅ **Health Check**: Added `/health` endpoint for Render to monitor server status
2. ✅ **PORT Handling**: Server now properly uses Render's dynamically assigned PORT
3. ✅ **CORS Configuration**: Updated to handle Render's frontend URL
4. ✅ **Environment Variables**: Added missing admin credentials
5. ✅ **Logging**: Enhanced logging for better debugging

## Deployment Steps

### 1. Backend Setup (inventory-backend)

#### Required Environment Variables on Render:
```
NODE_ENV=production
MONGODB_URI=<your-mongodb-connection-string>
JWT_SECRET=<auto-generated-by-render>
SESSION_SECRET=<auto-generated-by-render>
CLIENT_URL=https://inventory-frontend.onrender.com
ADMIN_USERNAME=admin
ADMIN_PASSWORD=<your-secure-password>
ADMIN_EMAIL=admin@company.com
```

**Important**:
- Don't set `PORT` manually - Render assigns this automatically
- Make sure your MongoDB URI allows connections from Render's IP addresses
- Update `CLIENT_URL` with your actual frontend URL

### 2. Frontend Setup (inventory-frontend)

#### Required Environment Variables:
```
VITE_API_URL=https://inventory-backend.onrender.com
```

Replace with your actual backend URL from Render.

### 3. MongoDB Atlas Configuration

If using MongoDB Atlas:
1. Go to Network Access
2. Add `0.0.0.0/0` to allow Render's dynamic IPs
3. Or use Render's static IP (paid plan)

### 4. Deployment Process

1. **Commit and Push Changes**:
   ```bash
   git add .
   git commit -m "Fix Render deployment configuration"
   git push origin main
   ```

2. **Render will automatically**:
   - Detect the `render.yaml` file
   - Build both services
   - Deploy backend and frontend
   - Run health checks

3. **Monitor Deployment**:
   - Check Render Dashboard logs
   - Verify `/health` endpoint returns 200 OK
   - Test login functionality

### 5. Troubleshooting

#### Server Not Starting
- Check Render logs for errors
- Verify all environment variables are set
- Ensure MongoDB URI is correct and accessible

#### Authentication Issues
- Clear browser cache/cookies
- Check JWT_SECRET is set
- Verify CORS origins in logs

#### Database Connection Issues
- Verify MongoDB Atlas network access
- Check connection string format
- Ensure database user has correct permissions

#### Frontend Can't Connect
- Verify VITE_API_URL is correct
- Check CORS errors in browser console
- Ensure backend health check passes

### 6. Health Check

Visit: `https://your-backend-url.onrender.com/health`

Expected response:
```json
{
  "status": "healthy",
  "timestamp": "2025-10-13T...",
  "uptime": 123.45,
  "environment": "production",
  "services": {
    "mongodb": {
      "status": "connected",
      "readyState": 1
    }
  }
}
```

### 7. Post-Deployment Checklist

- [ ] Backend health check returns 200
- [ ] Frontend loads without errors
- [ ] Can login with admin credentials
- [ ] Stock room displays data correctly
- [ ] All inventory features work
- [ ] Transactions are recorded

## Common Issues

### Issue: "Server loading but not executing"
**Solution**:
- Check if MongoDB connection is successful
- Verify health check returns 200
- Review Render logs for startup errors

### Issue: "Login works then stops after some time"
**Solution**:
- This is likely JWT token expiration
- Check JWT_SECRET is consistent across deployments
- Verify session management

### Issue: "CORS errors"
**Solution**:
- Update CLIENT_URL environment variable
- Check frontend URL matches exactly (no trailing slash)
- Clear browser cache

## Support

If issues persist:
1. Check Render logs (Dashboard → Logs)
2. Check browser console for errors
3. Verify environment variables are set correctly
4. Test `/health` endpoint
5. Review MongoDB Atlas logs
